{% extends "base.html" %}
{% load humanize %}

{% block title %}Déclarer mon paiement{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 py-8 space-y-6">

  <h1 class="text-2xl font-bold text-white flex items-center gap-3">
    <i class="fas fa-paper-plane text-primary-green"></i>
    Déclarer mon paiement
  </h1>

  <!-- Contrat -->
  <div class="bg-gray-900 rounded-xl border border-gray-800 p-5">
    <div class="grid sm:grid-cols-2 gap-4 text-sm">
      <div>
        <p class="text-gray-400">Police</p>
        <p class="text-white font-semibold">{{ contrat.numero_police|default:"-" }}</p>
      </div>
      <div>
        <p class="text-gray-400">Client</p>
        <p class="text-white font-semibold">{{ contrat.client.nom_complet }}</p>
      </div>
      <div>
        <p class="text-gray-400">Prime TTC</p>
        <p class="text-green-400 font-semibold">{{ contrat.prime_ttc|floatformat:0|intcomma }} F</p>
      </div>
      <div>
        <p class="text-gray-400">Net à reverser</p>
        <p class="text-blue-400 font-semibold">{{ paiement.montant_a_payer|floatformat:0|intcomma }} F</p>
      </div>
    </div>
  </div>

  <!-- Formulaire -->
  <form method="post" class="bg-gray-900 rounded-xl border border-gray-800 p-5 space-y-4">
    {% csrf_token %}
    {% if form.non_field_errors %}
      <div class="text-red-400 text-sm">{{ form.non_field_errors }}</div>
    {% endif %}

    <div class="grid md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm text-gray-300 mb-1">Méthode de paiement</label>
        {{ form.methode_paiement }}
        {% if form.methode_paiement.errors %}
          <p class="text-red-400 text-xs mt-1">{{ form.methode_paiement.errors.0 }}</p>
        {% endif %}
      </div>

      <div>
        <label class="block text-sm text-gray-300 mb-1">Référence transaction</label>
        {{ form.reference_transaction }}
        {% if form.reference_transaction.errors %}
          <p class="text-red-400 text-xs mt-1">{{ form.reference_transaction.errors.0 }}</p>
        {% endif %}
      </div>

      <div>
        <label class="block text-sm text-gray-300 mb-1">N° compte / Wallet</label>
        {{ form.numero_compte }}
        {% if form.numero_compte.errors %}
          <p class="text-red-400 text-xs mt-1">{{ form.numero_compte.errors.0 }}</p>
        {% endif %}
      </div>

      <div class="md:col-span-2">
        <label class="block text-sm text-gray-300 mb-1">Notes</label>
        {{ form.notes }}
        {% if form.notes.errors %}
          <p class="text-red-400 text-xs mt-1">{{ form.notes.errors.0 }}</p>
        {% endif %}
      </div>
    </div>

    <div class="flex items-center justify-end gap-3 pt-2">
      <a href="{% url 'payments:mes_paiements' %}"
         class="px-4 py-2 rounded-lg border border-gray-700 text-gray-200 hover:bg-gray-800">Annuler</a>
      <button type="submit"
              class="px-5 py-2 rounded-lg bg-primary-green/90 text-black font-semibold hover:bg-primary-green">
        Soumettre la déclaration
      </button>
    </div>
  </form>

</div>
{% endblock %}
