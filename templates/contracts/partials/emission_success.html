{% load humanize %}

<div class="bg-gray-900 rounded-xl border border-gray-800 shadow-2xl overflow-hidden relative max-w-2xl mx-auto animate-fadeIn">
    <div class="absolute top-0 inset-x-0 h-1 bg-gradient-to-r from-transparent via-green-500 to-transparent opacity-75"></div>

    {% if error %}
        <div class="p-8 text-center">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-red-500/10 text-red-500 mb-4 border border-red-500/20">
                <i class="fas fa-times text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-white mb-2">Une erreur est survenue</h3>
            <p class="text-red-300 bg-red-900/20 border border-red-900/50 rounded-lg p-4 text-sm">{{ error }}</p>
        </div>
    {% else %}
        <div class="p-8">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-green-500/10 rounded-full mb-4 ring-1 ring-green-500/30 shadow-[0_0_15px_rgba(34,197,94,0.2)]">
                    <i class="fas fa-check text-4xl text-green-500"></i>
                </div>
                <h2 class="text-2xl font-bold text-white tracking-tight">
                    Félicitations !
                </h2>
                <p class="text-green-400 font-medium mt-2 bg-green-900/20 py-2 px-4 rounded-lg inline-block border border-green-800">
                    {{ success_message|default:"Merci d'encaisser le montant TTC svp avant de valider" }}
                </p>
            </div>

            <div class="bg-gray-800/50 rounded-xl p-5 border border-gray-700/50 mb-6">
                <div class="grid grid-cols-2 gap-y-6 gap-x-4">
                    <div>
                        <p class="text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">N° Police</p>
                        <p class="text-white font-mono font-bold">{{ contrat.numero_police|default:"—" }}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Prime TTC</p>
                        <p class="text-green-400 font-bold text-xl">
                            {{ contrat.prime_ttc|default_if_none:0|floatformat:0|intcomma }} <span class="text-sm font-normal text-gray-400">FCFA</span>
                        </p>
                    </div>
                    <div class="col-span-2 border-t border-dashed border-gray-700/70"></div>
                    <div>
                        <p class="text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Client</p>
                        <p class="text-gray-200 font-semibold truncate">
                            {{ contrat.client.nom_complet|default:"—" }}
                        </p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-gray-500 uppercase tracking-wider font-medium mb-1">Véhicule</p>
                        <p class="text-gray-200 font-semibold">
                            {{ contrat.vehicule.immatriculation|default:"—" }}
                        </p>
                    </div>
                </div>
            </div>

            <div class="space-y-3">
                {% if user.role == 'APPORTEUR' %}
                    <a href="{% url 'payments:declarer_paiement' contrat.id %}"
                       class="w-full bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-3 px-4 rounded-lg shadow-lg shadow-yellow-900/20 transition-all transform hover:-translate-y-0.5 flex justify-center items-center gap-2 text-lg">
                        <i class="fas fa-money-bill-wave"></i> Payer maintenant
                    </a>
                {% endif %}

                {% with att=contrat.link_attestation|default:'' carte=contrat.link_carte_brune|default:'' %}
                <div class="grid grid-cols-2 gap-3">
                    {% if att %}
                        <a href="{{ att }}" target="_blank"
                           class="flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white border border-gray-600 transition-colors font-medium text-center text-sm">
                            <i class="fas fa-download text-red-400"></i> Télécharger attestation
                        </a>
                    {% endif %}
                    {% if carte %}
                        <a href="{{ carte }}" target="_blank"
                           class="flex items-center justify-center gap-2 px-4 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white border border-gray-600 transition-colors font-medium text-center text-sm">
                            <i class="fas fa-download text-yellow-500"></i> Télécharger CEDEAO
                        </a>
                    {% endif %}
                </div>

                {% if whatsapp_text %}
                    <a href="https://wa.me/?text= {{ whatsapp_text|urlencode }}"
                       target="_blank"
                       class="w-full bg-[#25D366] hover:bg-[#128C7E] text-white font-bold py-3 px-4 rounded-lg shadow-lg transition-all flex justify-center items-center gap-2 mt-2">
                        <i class="fab fa-whatsapp text-xl"></i> Partager sur WhatsApp
                    </a>
                {% endif %}
                {% endwith %}

                <a href="{% url 'contracts:detail_contrat' pk=contrat.pk %}"
                   class="block text-center text-gray-400 hover:text-white text-sm mt-4 underline">
                    Détails du contrat
                </a>
            </div>
        </div>
    {% endif %}
</div>