{% load widget_tweaks %}

<div class="form-section">
  <h2 class="text-2xl font-semibold text-white mb-4 flex items-center">
    <i class="fas fa-car mr-2 text-green-400"></i> Informations Véhicule
  </h2>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

    <!-- Immatriculation -->
    <div class="field-group">
      <label for="{{ vehicule_form.immatriculation.id_for_label }}" class="block text-gray-300 text-sm font-medium mb-2">
        <i class="fas fa-id-card mr-1 text-green-500"></i>
        Immatriculation <span class="text-red-400">*</span>
      </label>
      {% render_field vehicule_form.immatriculation %}
      <div id="immat-error"></div>
      <div id="immat-loading" class="hidden text-primary-green text-xs mt-1">
        <i class="fas fa-spinner fa-spin mr-1"></i> Vérification...
      </div>
      {% if vehicule_form.immatriculation.errors %}
        <p class="text-red-500 text-xs mt-1">{{ vehicule_form.immatriculation.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Marque -->
    <div class="field-group">
      <label for="{{ vehicule_form.marque.id_for_label }}" class="block text-gray-300 text-sm font-medium mb-2">
        <i class="fas fa-tag mr-1 text-green-500"></i> Marque <span class="text-red-400">*</span>
      </label>
      {% render_field vehicule_form.marque %}
      {% if vehicule_form.marque.errors %}
        <p class="text-red-500 text-xs mt-1">{{ vehicule_form.marque.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Modèle -->
    <div class="field-group">
      <label for="{{ vehicule_form.modele.id_for_label }}" class="block text-gray-300 text-sm font-medium mb-2">
        <i class="fas fa-car-side mr-1 text-green-500"></i> Modèle <span class="text-red-400">*</span>
      </label>
      {% render_field vehicule_form.modele %}
      {% if vehicule_form.modele.errors %}
        <p class="text-red-500 text-xs mt-1">{{ vehicule_form.modele.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Catégorie -->
    <div class="field-group">
      <label for="{{ vehicule_form.categorie.id_for_label }}" class="block text-gray-300 text-sm font-medium mb-2">
        <i class="fas fa-layer-group mr-1 text-green-500"></i>
        Catégorie <span class="text-red-400">*</span>
      </label>

      {{ vehicule_form.categorie
         |attr:"hx-get:/contracts/load-sous-categories/"
         |attr:"hx-target:#sous-categorie-wrapper"
         |attr:"hx-swap:outerHTML"  |attr:"hx-trigger:change"
         |attr:"hx-indicator:#sc-loading"
      }}

      <div id="sc-loading" class="hidden text-green-400 text-xs mt-1">
        <i class="fas fa-spinner fa-spin mr-1"></i> Chargement des sous-catégories...
      </div>

      {% if vehicule_form.categorie.errors %}
        <p class="text-red-500 text-xs mt-1">{{ vehicule_form.categorie.errors.0 }}</p>
      {% endif %}
    </div>

    <!-- Sous-catégorie -->
    <div id="sous-categorie-wrapper" class="field-group md:col-span-2 lg:col-span-1">
      {% include "contracts/partials/_sous_categorie_select.html" %}
    </div>

    <!-- Autres champs -->
    <div class="field-group">
      <label for="{{ vehicule_form.puissance_fiscale.id_for_label }}" class="block text-gray-300 text-sm font-medium mb-2">
        <i class="fas fa-tachometer-alt mr-1 text-green-500"></i> Puissance (CV) <span class="text-red-400">*</span>
      </label>
      {% render_field vehicule_form.puissance_fiscale %}
    </div>

    <div class="field-group">
      <label for="{{ vehicule_form.nombre_places.id_for_label }}" class="block text-gray-300 text-sm font-medium mb-2">
        <i class="fas fa-users mr-1 text-green-500"></i> Nombre de places <span class="text-red-400">*</span>
      </label>
      {% render_field vehicule_form.nombre_places %}
    </div>

    <div class="field-group">
      <label for="{{ vehicule_form.carburant.id_for_label }}" class="block text-gray-300 text-sm font-medium mb-2">
        <i class="fas fa-gas-pump mr-1 text-green-500"></i> Carburant <span class="text-red-400">*</span>
      </label>
      {% render_field vehicule_form.carburant %}
    </div>
  </div>

  <div class="hidden">
    {{ vehicule_form.valeur_neuve }}
    {{ vehicule_form.valeur_venale }}
    {{ vehicule_form.charge_utile }}
  </div>
</div>
