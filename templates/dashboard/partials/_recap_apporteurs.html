{% load humanize %}
<div class="bg-gray-900 rounded-xl p-6 border border-gray-800 mt-6">
    <h2 class="text-xl font-semibold text-white mb-4">
        <i class="fas fa-users mr-2 text-blue-400"></i> Résumé par Apporteur
    </h2>
    <div class="overflow-x-auto">
        <style>.tabular-nums{font-variant-numeric:tabular-nums}</style>
        <table class="w-full min-w-[700px] text-sm font-semibold">
            <thead>
                <tr class="border-b border-gray-800 text-gray-400">
                    <th class="py-2 px-3 text-left">Apporteur</th>
                    <th class="py-2 px-3 text-right">Contrats</th>
                    <th class="py-2 px-3 text-right">Primes</th>
                    <th class="py-2 px-3 text-right">Commissions (Apporteur)</th>
                    {% if user.is_true_admin %}
                        <th class="py-2 px-3 text-right">Commissions (BWHITE)</th>
                        <th class="py-2 px-3 text-right">Net à Reverser (Askia)</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for a in recap_apporteurs %}
                    <tr class="border-b border-gray-800 hover:bg-gray-800 transition">
                        <td class="py-2 px-3 text-white text-left">
                            <a href="?apporteur={{ a.apporteur__id }}"
                               class="text-blue-400 hover:text-blue-300">
                                {{ a.apporteur__first_name }} {{ a.apporteur__last_name }}
                            </a>
                        </td>
                        <td class="py-2 px-3 text-right tabular-nums">{{ a.nb_contrats|default_if_none:0|intcomma }}</td>
                        <td class="py-2 px-3 text-right tabular-nums">{{ a.total_primes|default_if_none:0|floatformat:0|intcomma }} FCFA</td>
                        <td class="py-2 px-3 text-right tabular-nums {% if a.total_commissions_apporteur > 0 %}text-green-400{% else %}text-gray-500{% endif %}">
                            {{ a.total_commissions_apporteur|default_if_none:0|floatformat:0|intcomma }} FCFA
                        </td>
                        {% if user.is_true_admin %}
                            <td class="py-2 px-3 text-right tabular-nums {% if a.total_commissions_bwhite > 0 %}text-blue-400{% else %}text-gray-500{% endif %}">
                                {{ a.total_commissions_bwhite|default_if_none:0|floatformat:0|intcomma }} FCFA
                            </td>
                            <td class="py-2 px-3 text-right tabular-nums {% if a.total_net > 0 %}text-orange-400{% else %}text-gray-500{% endif %}">
                                {{ a.total_net|default_if_none:0|floatformat:0|intcomma }} FCFA
                            </td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="{% if user.is_true_admin %}6{% else %}4{% endif %}" class="text-center py-3 text-gray-500">
                            Aucun apporteur trouvé
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
