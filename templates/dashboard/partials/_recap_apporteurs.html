{% load humanize %}
<div class="bg-gray-900 rounded-xl p-6 border border-gray-800 mt-6 shadow-2xl">
    <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-3">
        <h2 class="text-xl font-extrabold text-white flex items-center">
            <i class="fas fa-users mr-3 text-primary-green"></i>
            Résumé par Apporteur
        </h2>
    </div>

    <div class="overflow-x-auto">
        <table class="w-full text-sm font-medium border-separate border-spacing-y-1 min-w-[700px]">
            <thead class="bg-gray-950/50 text-gray-400 uppercase text-xs tracking-wider">
                <tr>
                    <th class="py-3 px-3 text-left rounded-l-lg">Apporteur</th>
                    <th class="py-3 px-3 text-right">Contrats</th>
                    <th class="py-3 px-3 text-right">Primes Totales</th>
                    <th class="py-3 px-3 text-right">Commissions (App.)</th>
                    {% if user.is_true_admin %}
                        <th class="py-3 px-3 text-right text-blue-300">Marge BWHITE</th>
                        <th class="py-3 px-3 text-right text-purple-300 rounded-r-lg">Net à Reverser</th>
                    {% else %}
                        <th class="rounded-r-lg"></th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for a in recap_apporteurs %}
                    <tr class="bg-gray-800/40 hover:bg-gray-800 transition duration-150 group">
                        <td class="py-3 px-3 text-white">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-300">
                                    {{ a.apporteur__first_name|first|upper }}{{ a.apporteur__last_name|first|upper }}
                                </div>
                                <a href="?apporteur={{ a.apporteur__id }}"
                                   class="text-white hover:text-primary-green font-medium transition">
                                    {{ a.apporteur__first_name }} {{ a.apporteur__last_name }}
                                </a>
                            </div>
                        </td>

                        <td class="py-3 px-3 text-right tabular-nums text-gray-300">
                            <span class="bg-gray-700/50 px-2 py-1 rounded text-xs">
                                {{ a.nb_contrats|default_if_none:0|intcomma }}
                            </span>
                        </td>

                        <td class="py-3 px-3 text-right tabular-nums text-white font-semibold">
                            {{ a.total_primes|default_if_none:0|floatformat:0|intcomma }} F
                        </td>

                        <td class="py-3 px-3 text-right tabular-nums">
                            <span class="{% if a.total_commissions_apporteur > 0 %}text-yellow-400{% else %}text-gray-600{% endif %} font-medium">
                                {{ a.total_commissions_apporteur|default_if_none:0|floatformat:0|intcomma }} F
                            </span>
                        </td>

                        {% if user.is_true_admin %}
                            <td class="py-3 px-3 text-right tabular-nums">
                                <span class="{% if a.total_commissions_bwhite > 0 %}text-blue-400 bg-blue-900/20 px-2 py-1 rounded{% else %}text-gray-600{% endif %} text-xs font-medium">
                                    {{ a.total_commissions_bwhite|default_if_none:0|floatformat:0|intcomma }} F
                                </span>
                            </td>
                            <td class="py-3 px-3 text-right tabular-nums">
                                <span class="{% if a.total_net > 0 %}text-purple-400{% else %}text-gray-600{% endif %} font-medium">
                                    {{ a.total_net|default_if_none:0|floatformat:0|intcomma }} F
                                </span>
                            </td>
                        {% else %}
                            <td></td>
                        {% endif %}
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="{% if user.is_true_admin %}6{% else %}4{% endif %}" class="text-center py-8 text-gray-500 italic">
                            <i class="fas fa-users-slash text-2xl mb-2 opacity-50"></i><br>
                            Aucune donnée disponible pour cette période.
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>