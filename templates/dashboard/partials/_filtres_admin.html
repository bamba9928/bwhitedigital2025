<style>
    /* Force le background sombre et le texte clair */
    .form-dark-theme select,
    .form-dark-theme input[type="text"],
    .form-dark-theme input[type="date"] {
        background-color: #1f2937 !important; /* bg-gray-800 */
        border: 1px solid #374151 !important; /* border-gray-700 */
        color: #e5e7eb !important; /* text-gray-200 */
        border-radius: 0.5rem; /* rounded-lg */
        padding: 0.5rem 0.75rem;
        width: 100%;
        appearance: none; /* Pour nettoyer le style par défaut */
    }

    /* Style des options de la liste déroulante (Chrome/Windows) */
    .form-dark-theme select option {
        background-color: #1f2937;
        color: #fff;
    }

    /* Focus uniformisé (Vert) */
    .form-dark-theme select:focus,
    .form-dark-theme input:focus {
        border-color: #16a34a !important; /* green-600 */
        box-shadow: 0 0 0 1px #16a34a !important;
        outline: none;
    }

    /* Placeholder */
    .form-dark-theme ::placeholder {
        color: #9ca3af; /* gray-400 */
    }
</style>

<div class="bg-gray-900 rounded-xl border border-gray-800 shadow-lg overflow-hidden">
    <button type="button"
            class="w-full flex justify-between items-center px-5 py-4 text-white font-semibold hover:bg-gray-800/80 transition-colors"
            onclick="document.getElementById('filters-admin').classList.toggle('hidden')">
        <span class="flex items-center gap-2">
            <i class="fas fa-filter text-primary-green"></i>
            Filtres avancés
        </span>
        <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
    </button>

    <div id="filters-admin" class="hidden border-t border-gray-800 px-5 py-5 bg-gray-900/50 animate-fadeIn">

        <form id="form-filtres-admin" method="get" class="grid grid-cols-1 md:grid-cols-3 gap-5 form-dark-theme">

            <div>
                <label class="block text-gray-300 text-sm font-medium mb-1.5">Période</label>
                <div class="relative">
                    <select name="periode">
                        <option value="">-- Choisir --</option>
                        {% for key, label in periode_choices %}
                            <option value="{{ key }}" {% if periode == key %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-400">
                        <i class="fas fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-gray-300 text-sm font-medium mb-1.5">Statut Contrat</label>
                <div class="relative">
                    <select name="statut">
                        <option value="">-- Tous --</option>
                        {% for key, label in statut_choices %}
                            <option value="{{ key }}" {% if statut == key %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-400">
                        <i class="fas fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-gray-300 text-sm font-medium mb-1.5">Apporteur</label>
                <div class="relative">
                    <select name="apporteur">
                        <option value="">Tous</option>
                        {% for a in apporteurs %}
                            <option value="{{ a.id }}" {% if apporteur_id == a.id|stringformat:'s' %}selected{% endif %}>
                                {{ a.get_full_name }}
                            </option>
                        {% endfor %}
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-400">
                        <i class="fas fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-gray-300 text-sm font-medium mb-1.5">Date début</label>
                <input type="date" name="date_debut" value="{{ date_debut|date:'Y-m-d' }}">
            </div>

            <div>
                <label class="block text-gray-300 text-sm font-medium mb-1.5">Date fin</label>
                <input type="date" name="date_fin" value="{{ date_fin|date:'Y-m-d' }}">
            </div>

            <div class="md:col-span-3 md:w-2/3">
                <label class="block text-gray-300 text-sm font-medium mb-1.5">Recherche</label>
                <div class="flex items-center gap-2">
                    <div class="relative flex-1">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-500"></i>
                        </div>
                        <input type="text"
                               name="search"
                               value="{{ search }}"
                               placeholder="Immatriculation, Nom, Prénom..."
                               style="padding-left: 2.5rem;">
                    </div>
                    {% if search %}
                        <a href="{% url 'dashboard:home' %}"
                           class="p-2 text-red-400 hover:text-red-300 hover:bg-red-900/20 rounded-lg transition-colors"
                           title="Effacer la recherche">
                            <i class="fas fa-times"></i>
                        </a>
                    {% endif %}
                </div>
            </div>

            <div class="md:col-span-3 pt-4 border-t border-gray-800 flex flex-wrap items-center gap-3">
                <button type="submit"
                        class="px-5 py-2 rounded-lg bg-green-600 hover:bg-green-500 text-white font-semibold shadow-lg shadow-green-900/20 transition-all transform hover:-translate-y-0.5 flex items-center gap-2">
                    <i class="fas fa-check"></i> Appliquer
                </button>

                <a href="{% url 'dashboard:home' %}"
                   class="px-5 py-2 rounded-lg border border-gray-600 text-gray-300 hover:bg-gray-800 hover:text-white transition-colors flex items-center gap-2">
                    <i class="fas fa-undo text-xs"></i> Réinitialiser
                </a>

                <a href="{% url 'accounts:nouveau_apporteur' %}"
                   class="ml-auto px-5 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-semibold shadow-lg shadow-blue-900/20 transition-all transform hover:-translate-y-0.5 flex items-center gap-2">
                    <i class="fas fa-user-plus"></i> <span class="hidden sm:inline">Nouveau Apporteur</span>
                </a>
            </div>
        </form>

        {% if periode or statut or apporteur_id or search %}
            <div class="mt-5 flex flex-wrap gap-2 p-3 bg-gray-800/50 rounded-lg border border-dashed border-gray-700">
                <span class="text-xs text-gray-500 font-medium uppercase tracking-wider flex items-center mr-1">Filtres actifs :</span>
                {% if periode %}
                    <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-green-900/50 text-green-300 border border-green-800">
                        Période : {{ periode }}
                    </span>
                {% endif %}
                {% if statut %}
                    <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-blue-900/50 text-blue-300 border border-blue-800">
                        Statut : {{ statut }}
                    </span>
                {% endif %}
                {% if apporteur_id %}
                    <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-purple-900/50 text-purple-300 border border-purple-800">
                        Apporteur : {{ apporteur_id }}
                    </span>
                {% endif %}
                {% if search %}
                    <span class="inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium bg-yellow-900/50 text-yellow-300 border border-yellow-800">
                        Recherche : "{{ search }}"
                    </span>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>